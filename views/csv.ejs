<!-- <!DOCTYPE html>
<html>
<head>
  <title>CSV File Content</title>
  <style>
    body{
        background-color: rgba(255,255,240);
    }
    table {
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      border: 1px solid black;
    }

    tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    tbody tr:last-child {
      border-bottom: none;
    }
  </style>
  <a href="/"><button style="background-color: aqua; padding: 5px; margin: 5px; font-weight: bold;">Go Back</button></a>
</head>
<body>
  <h1>CSV File Content</h1>

  <div>
    <label for="searchInput">Search:</label>
    <input type="text" id="searchInput">
    <button id="searchButton" style="background-color: aquamarine; padding: 5px; margin: 5px; font-weight: bold;">Search</button>
  </div>

  <% if (rows && rows.length > 0) { %>
    <table>
      <thead>
        <tr>
          <% Object.keys(rows[0]).forEach(function(header) { %>
            <th><%= header %></th>
          <% }) %>
        </tr>
      </thead>
      <tbody>
        <% rows.forEach(function(row, rowIndex) { %>
          <tr>
            <% Object.entries(row).forEach(function([key, value], columnIndex) { %>
              <td><div style="border: 1px solid black; padding: 4px;"><%= value %></div></td>
            <% }) %>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>No CSV file content to display.</p>
  <% } %>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchInput');
      const searchButton = document.getElementById('searchButton');
      const tableRows = document.querySelectorAll('tbody tr');

      searchButton.addEventListener('click', function() {
        const searchText = searchInput.value.trim().toLowerCase();
        if (searchText === '') {
          resetSearch();
        } else {
          filterRows(searchText);
        }
      });

      function filterRows(searchText) {
        tableRows.forEach(function(row) {
          const cells = row.querySelectorAll('td');
          let rowMatch = false;
          cells.forEach(function(cell) {
            if (cell.textContent.toLowerCase().includes(searchText)) {
              rowMatch = true;
            }
          });
          if (rowMatch) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      }

      function resetSearch() {
        tableRows.forEach(function(row) {
          row.style.display = '';
        });
      }
    });
  </script>
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
  <title>CSV File Content</title>
  <style>
    body {
      background-color: rgba(255, 255, 240);
    }

    table {
      border-collapse: collapse;
    }

    th,
    td {
      padding: 8px;
      border: 1px solid black;
    }

    tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    tbody tr:last-child {
      border-bottom: none;
    }

    #chart-container {
      margin-top: 20px;
    }

    /* Adjust the font size of x-axis tick labels */
    svg text {
      font-size: 12px;
    }
  </style>
  <a href="/"><button style="background-color: aqua; padding: 5px; margin: 5px; font-weight: bold;">Go Back</button></a>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
  <h1>CSV File Content</h1>

  <div>
    <label for="searchInput">Search: </label>
    <input type="text" id="searchInput" placeholder="Enter search text">
    <button id="searchButton" style="background-color: aquamarine; padding: 5px; margin: 5px; font-weight: bold;">Search</button>
  </div>  

  <div style="display: flex-box; justify-content: center;" class="pagination">
    <% const totalPages = Math.ceil(rows.length / 100); %>
    <% for (let i = 1; i <= totalPages; i++) { %>
      <button style="background-color: aquamarine; font-weight: bold; margin: 5px; padding: 5px;" class="page-button" data-page="<%= i %>"><%= i %></button>
    <% } %>
  </div>

  <% if (rows && rows.length > 0) { %>
    <table>
      <thead>
        <tr>
          <% Object.keys(rows[0]).forEach(function(key) { %>
            <th>
              <div>
                <%= key %>
              </div>
            </th>
          <% }) %>
        </tr>
      </thead>
      <tbody id="tableBody">
        <% rows.forEach(function(row, rowIndex) { %>
          <tr>
            <% Object.values(row).forEach(function(value, columnIndex) { %>
              <td>
                <div style="border: 1px solid black; padding: 4px;">
                  <%= value %>
                </div>
              </td>
            <% }) %>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>No CSV file content to display.</p>
  <% } %>

  <div id="chart-container"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchInput');
      const searchButton = document.getElementById('searchButton');
      const tableBody = document.getElementById('tableBody');
      const pageButtons = document.querySelectorAll('.page-button');
      const tableRows = Array.from(tableBody.querySelectorAll('tr'));
      const chartContainer = document.getElementById('chart-container');
      let chart;

      const recordsPerPage = 100;
      let currentPage = 1;

      function updateTableDisplay() {
        const startIndex = (currentPage - 1) * recordsPerPage;
        const endIndex = startIndex + recordsPerPage;

        tableRows.forEach(function(row, index) {
          if (index >= startIndex && index < endIndex) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });

        pageButtons.forEach(function(button) {
          const page = parseInt(button.dataset.page);
          if (page === currentPage) {
            button.style.fontWeight = 'bold';
          } else {
            button.style.fontWeight = 'normal';
          }
        });
      }

      function filterRows(searchText) {
        tableRows.forEach(function(row) {
          const cells = row.querySelectorAll('td');
          let rowMatch = false;
          cells.forEach(function(cell) {
            if (cell.textContent.toLowerCase().includes(searchText)) {
              rowMatch = true;
            }
          });
          if (rowMatch) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      }

      function resetSearch() {
        tableRows.forEach(function(row) {
          row.style.display = '';
        });
      }

      searchButton.addEventListener('click', function() {
        const searchText = searchInput.value.trim().toLowerCase();
        if (searchText === '') {
          resetSearch();
        } else {
          filterRows(searchText);
        }
      });

      pageButtons.forEach(function(button) {
        button.addEventListener('click', function() {
          const page = parseInt(button.dataset.page);
          currentPage = page;
          updateTableDisplay();
        });
      });

      tableBody.addEventListener('click', function(event) {
        if (event.target.tagName === 'TD') {
          const column = event.target.cellIndex;
          drawChart(column);
        }
      });

      function drawChart(column) {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Value');
        data.addColumn('number', 'Count');

        const countMap = new Map();
        tableRows.forEach(function(row) {
          const value = row.querySelectorAll('td')[column].textContent;
          if (countMap.has(value)) {
            countMap.set(value, countMap.get(value) + 1);
          } else {
            countMap.set(value, 1);
          }
        });

        countMap.forEach(function(count, value) {
          data.addRow([value, count]);
        });

        const options = {
          title: 'Column Chart',
          width: '100%',
          height: 400,
          legend: { position: 'none' },
          chartArea: { left: 50, top: 50, right: 20, bottom: 100 },
          hAxis: {
            slantedText: false // Display x-axis labels normally
          }
        };

        if (chart) {
          chart.clearChart();
        }

        chart = new google.visualization.ColumnChart(chartContainer);
        chart.draw(data, options);
      }

      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(function() {
        drawChart(0); // Draw initial chart with the first column
      });

      updateTableDisplay();
    });
  </script>
</body>
</html>



<!-- <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script> -->




